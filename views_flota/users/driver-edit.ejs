<% layout('layouts/main') %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="h4 mb-0"><i class="fas fa-pen me-2"></i>Editar Conductor</h2>
  <a href="/drivers/<%= driver._id %>" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Volver</a>
</div>

<form action="/drivers/<%= driver._id %>?_method=PUT" method="POST" enctype="multipart/form-data">
  <!-- Información Personal -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 bg-primary text-white">
      <h6 class="m-0 font-weight-bold"><i class="fas fa-user me-2"></i>Información Personal</h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="name" class="form-label">Nombre Completo *</label>
          <input type="text" class="form-control" name="name" id="name" value="<%= driver.name %>" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="phone" class="form-label">Teléfono</label>
          <input type="tel" class="form-control" name="phone" id="phone" value="<%= driver.phone || '' %>">
        </div>
        <div class="col-md-6 mb-3">
          <label for="email" class="form-label">Correo Electrónico</label>
          <input type="email" class="form-control" name="email" id="email" value="<%= driver.email || '' %>">
        </div>
        <div class="col-md-6 mb-3">
          <label for="birthDate" class="form-label">Fecha de Nacimiento</label>
          <input type="date" class="form-control" name="birthDate" id="birthDate" value="<%= driver.birthDate ? new Date(driver.birthDate).toISOString().split('T')[0] : '' %>">
        </div>
        <div class="col-md-6 mb-3">
          <label for="bloodType" class="form-label">Tipo de Sangre</label>
          <select class="form-select" name="bloodType" id="bloodType">
            <option value="">Seleccionar...</option>
            <option value="A+" <%= driver.bloodType === 'A+' ? 'selected' : '' %>>A+</option>
            <option value="A-" <%= driver.bloodType === 'A-' ? 'selected' : '' %>>A-</option>
            <option value="B+" <%= driver.bloodType === 'B+' ? 'selected' : '' %>>B+</option>
            <option value="B-" <%= driver.bloodType === 'B-' ? 'selected' : '' %>>B-</option>
            <option value="AB+" <%= driver.bloodType === 'AB+' ? 'selected' : '' %>>AB+</option>
            <option value="AB-" <%= driver.bloodType === 'AB-' ? 'selected' : '' %>>AB-</option>
            <option value="O+" <%= driver.bloodType === 'O+' ? 'selected' : '' %>>O+</option>
            <option value="O-" <%= driver.bloodType === 'O-' ? 'selected' : '' %>>O-</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label for="status" class="form-label">Estado</label>
          <select class="form-select" name="status" id="status">
            <option value="activo" <%= driver.status === 'activo' ? 'selected' : '' %>>Activo</option>
            <option value="vacaciones" <%= driver.status === 'vacaciones' ? 'selected' : '' %>>Vacaciones</option>
            <option value="suspendido" <%= driver.status === 'suspendido' ? 'selected' : '' %>>Suspendido</option>
            <option value="inactivo" <%= driver.status === 'inactivo' ? 'selected' : '' %>>Inactivo</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Contacto de Emergencia -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 bg-warning text-dark">
      <h6 class="m-0 font-weight-bold"><i class="fas fa-phone me-2"></i>Contacto de Emergencia</h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="emergencyContactName" class="form-label">Nombre del Contacto</label>
          <input type="text" class="form-control" name="emergencyContactName" id="emergencyContactName" value="<%= driver.emergencyContact?.name || '' %>">
        </div>
        <div class="col-md-4 mb-3">
          <label for="emergencyContactPhone" class="form-label">Teléfono</label>
          <input type="tel" class="form-control" name="emergencyContactPhone" id="emergencyContactPhone" value="<%= driver.emergencyContact?.phone || '' %>">
        </div>
        <div class="col-md-4 mb-3">
          <label for="emergencyContactRelationship" class="form-label">Parentesco</label>
          <input type="text" class="form-control" name="emergencyContactRelationship" id="emergencyContactRelationship" value="<%= driver.emergencyContact?.relationship || '' %>" placeholder="Ej: Esposa, Padre, Hermano">
        </div>
      </div>
    </div>
  </div>

  <!-- Dirección -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 bg-info text-white">
      <h6 class="m-0 font-weight-bold"><i class="fas fa-map-marker-alt me-2"></i>Dirección</h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-8 mb-3">
          <label for="addressStreet" class="form-label">Dirección</label>
          <input type="text" class="form-control" name="addressStreet" id="addressStreet" value="<%= driver.address?.street || '' %>" placeholder="Calle, número, zona">
        </div>
        <div class="col-md-4 mb-3">
          <label for="addressCity" class="form-label">Ciudad</label>
          <input type="text" class="form-control" name="addressCity" id="addressCity" value="<%= driver.address?.city || '' %>">
        </div>
        <div class="col-md-6 mb-3">
          <label for="addressDepartment" class="form-label">Departamento</label>
          <input type="text" class="form-control" name="addressDepartment" id="addressDepartment" value="<%= driver.address?.department || '' %>">
        </div>
        <div class="col-md-6 mb-3">
          <label for="addressPostalCode" class="form-label">Código Postal</label>
          <input type="text" class="form-control" name="addressPostalCode" id="addressPostalCode" value="<%= driver.address?.postalCode || '' %>">
        </div>
      </div>
    </div>
  </div>

  <!-- Información Laboral -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 bg-success text-white">
      <h6 class="m-0 font-weight-bold"><i class="fas fa-briefcase me-2"></i>Información Laboral</h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="license" class="form-label">Número de Licencia *</label>
          <input type="text" class="form-control" name="license" id="license" value="<%= driver.license || '' %>" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="licenseExpiry" class="form-label">Vencimiento de Licencia</label>
          <input type="date" class="form-control" name="licenseExpiry" id="licenseExpiry" value="<%= driver.licenseExpiry ? new Date(driver.licenseExpiry).toISOString().split('T')[0] : '' %>">
        </div>
        <div class="col-md-6 mb-3">
          <label for="dpi" class="form-label">Número de DPI *</label>
          <input type="text" class="form-control" name="dpi" id="dpi" value="<%= driver.dpi || '' %>" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="position" class="form-label">Cargo</label>
          <input type="text" class="form-control" name="position" id="position" value="<%= driver.position || 'Conductor' %>">
        </div>
      </div>
    </div>
  </div>

  <!-- Documentos -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 bg-danger text-white">
      <h6 class="m-0 font-weight-bold"><i class="fas fa-file-alt me-2"></i>Documentos</h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="licenseFile" class="form-label">Licencia de Conducir (Imagen o PDF)</label>
          <input type="file" class="form-control" name="licenseFile" id="licenseFile" accept="image/*,application/pdf">
          <div class="form-text">Archivos permitidos: JPG, PNG, GIF, PDF (Máx. 5MB)</div>
          <% if (driver.licenseFile) { %>
            <div class="mt-2">
              <small class="text-muted">Archivo actual: </small>
              <a href="<%= driver.licenseFile %>" target="_blank" class="text-decoration-none">
                <i class="fas fa-file me-1"></i><%= driver.licenseFile.split('/').pop() %>
              </a>
            </div>
          <% } %>
        </div>
        <div class="col-md-6 mb-3">
          <label for="dpiFile" class="form-label">Documento de Identificación (DPI) (Imagen o PDF)</label>
          <input type="file" class="form-control" name="dpiFile" id="dpiFile" accept="image/*,application/pdf">
          <div class="form-text">Archivos permitidos: JPG, PNG, GIF, PDF (Máx. 5MB)</div>
          <% if (driver.dpiFile) { %>
            <div class="mt-2">
              <small class="text-muted">Archivo actual: </small>
              <a href="<%= driver.dpiFile %>" target="_blank" class="text-decoration-none">
                <i class="fas fa-file me-1"></i><%= driver.dpiFile.split('/').pop() %>
              </a>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <!-- Información Médica -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 bg-secondary text-white">
      <h6 class="m-0 font-weight-bold"><i class="fas fa-heartbeat me-2"></i>Información Médica</h6>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label for="allergies" class="form-label">Alergias (separadas por comas)</label>
        <input type="text" class="form-control" name="allergies" id="allergies" value="<%= driver.medicalInfo?.allergies ? driver.medicalInfo.allergies.join(', ') : '' %>" placeholder="Ej: Penicilina, Polen, Mariscos">
        <div class="form-text">Escriba las alergias separadas por comas</div>
      </div>
      <div class="mb-3">
        <label for="medicalNotes" class="form-label">Notas Médicas</label>
        <textarea class="form-control" name="medicalNotes" id="medicalNotes" rows="3" placeholder="Información médica adicional, condiciones especiales, etc."><%= driver.medicalInfo?.medicalNotes || '' %></textarea>
      </div>
    </div>
  </div>

  <div class="d-grid mt-4">
    <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-save me-2"></i>Guardar Cambios</button>
  </div>
</form>


